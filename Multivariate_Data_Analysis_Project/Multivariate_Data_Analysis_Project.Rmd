---
title: "Multivariate_Data_Analysis_Project"
author: "Sara Vasques"
date: "2025-11-07"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Project

In a study on pollution, carried out in 41 cities in the USA, the following variables were considered:

**so2** - Sulfur dioxide content of air in micrograms per cubic meter

**temp** -Average annual temperature (F)

**manuf** - No. of manufacturing enterprises employing 20 or more workers

**pop** - Population size (1970 census) in thousands

**wind** - Average wind speed in miles per hour

**precip** - Average annual precipitation in inches

**days** - Average number of days with precipitation per year (annual average number of days of rain)



### Uploading the Data

**UPLOADING THE DATA**

```{r}
#RUN DATA
data5 <- read.csv("data_5.csv", header = TRUE)
head(data5)

```

**CHOOSING THE VARIABLES**

All but the city since it's not numeric.

```{r}
dim(data5)
```

```{r}
data5_variables <- data5[,2:8]
head(data5_variables)
```

### 1) Preliminary Analysis of the Data

```{r}
summary(data5_variables)
```


### PreProcessing of the Data

Since the measures of each column are very different, we have to use a correlation matrix to start the PCA.

**CORRELATION MATRIX**

```{r}
## 1st) Determine the correlation matrix

cor_data5 <- cor(data5_variables)
cor_data5

```

**OBTAIN THE EIGENVALUES AND EIGENVECTORS**

```{r}
## 2nd) Obtain eigenvectors and eigenvalues

eigen_data5 <- eigen(cor_data5)
eigen_data5
```
**CRITERIA 1 => ANALYSING WITH KAISER'S CRITERIA**

*Analyzing the results*, we should retain the first 3 PCs because there are 3 eigenvalues that are >1 (Kaiser's Criteria).

But now we will perform PCA to see if 3 PCs explain the majority of the 

**CRITERIA 2 => PCA ANALYSIS**

```{r}
# Perfom PCA

pca_data5 <- princomp(data5_variables, cor = TRUE)

print(summary(pca_data5), loadings = TRUE)
```

*Analyzing the results*, we have 81% of the variance explained with the first 3 PCs (viewed in the cumulative proportion). However, if we consider 4 PCs, we will have 93% of the variance explained.

Since this is not conclusive, we should do the third criteria.

**CRITERIA 3 => SCREE PLOT**

```{r}
## Calculate total variance explained by each PC

var_explained_data5 = pca_data5$sdev^2 / sum(pca_data5$sdev^2)

## Create scree-plot
library(ggplot2)

qplot(c(1:7), var_explained_data5) +
  geom_line() +
  xlab("Principal Component") +
  ylab("Variance Explained") +
  ggtitle("Scree Plot")+
  ylim(0,1)
```

*Analyzing the results*, in this plot, the elbow point would be between PC2 and PC3. However, if we consider he other criterias we have applied before, it would be best to use 3 PCs, having 81% of the variance explained.

**SO LET'S CONSIDER 3 PCs**

Now, we need to see which are the variables that contribute more for the explanation of each principal component retained. 
We need to have a correlation matrix between the variables and the PCs.
(Loadings)

```{r}
# Correlation between original variables and the PCs (loadins) 

component_matrix <- cor(data5_variables,pca_data5$scores)
component_matrix
```
We only need to look into the the 3 first PCs.

**Comp 1** => explain so2, manuf and pop

**Comp 2** => explain precip and days

**Comp 3** => temp

Wind is only explained well with the 4th PC.

Let's prove that with:

```{r}
# Apply the rule for the 1st PC
# lambda1 / p

sqrt(eigen_data5$values[1]/8)
```

```{r}
# Apply the rule for the 2nd PC
# lambda1 / p

sqrt(eigen_data5$values[2]/8)
```

```{r}
# Apply the rule for the 3rd PC
# lambda1 / p

sqrt(eigen_data5$values[3]/8)
```

**GRAPHICAL REPRESENTATION**

If we did a graphic just for the first two PCS:

```{r}
library(devtools)
require(ggbiplot)
ggbiplot(pca_data5,labels = row.names(data5_variables))
```

However, we decided to work with the first 3 PCs.
So, if we did a graphic for the first 3 PCs:


```{r}
library(plotly)

# Supondo que vocÃª tenha feito o PCA:
pca_data5_2 <- prcomp(data5_variables, scale. = TRUE)

pca_scores <- as.data.frame(pca_data5_2$x)

var_explained <- (pca_data5$sdev)^2 / sum((pca_data5$sdev)^2)

pc1_label <- paste0("PC1 (", round(var_explained[1] * 100, 1), "%)")
pc2_label <- paste0("PC2 (", round(var_explained[2] * 100, 1), "%)")
pc3_label <- paste0("PC3 (", round(var_explained[3] * 100, 1), "%)")

plot_ly(pca_scores,
        x = ~PC1,
        y = ~PC2,
        z = ~PC3,
        type = 'scatter3d',
        mode = 'markers',
        text = rownames(pca_scores),
        marker = list(size = 4)
)%>%
  layout(
    title = "3D Graphic with the first 3 PCs",
    scene = list(
      xaxis = list(title = pc1_label),
      yaxis = list(title = pc2_label),
      zaxis = list(title = pc3_label)
    )
  )

```






